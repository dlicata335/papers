\newcommand\diagbase[0]{\ensuremath{\mathord{*}}}
\newcommand\interpdiag[2]{\ensuremath{[ #1 ]_{#2}}}

\section{Judgments}

We have a lot of judgments:

\paragraph{Coherences}

\begin{itemize}
\item $\wfdiag{\Delta}$
\item $\wfdiaglob{\Delta}{\diag G}$ (requires $\wfdiag{\Delta}$)
\item $\ofdiaglob{\Delta}{u}{\diag G}$ (requires $\wfdiaglob{\Delta}{\diag G}$)
\item $\substdiaglob{\Delta}{\diag \delta}{\Delta'}$ (requires $\wfdiag{\Delta}$
  and $\wfdiag{\Delta'}$)
\end{itemize}

\paragraph{Everything else}

\begin{itemize}
\item $\wfctx{\Gamma}$
% \item $\wfsub{\Gamma}{\theta}{\Gamma'}$ (requires $\wfctx{\Gamma}$ and
%   $\wfctx{\Gamma'}$)
% \item $\wftype{\Gamma}{A}$ (requires $\wfctx{\Gamma}$)
\item $\wfglob{\Gamma}{G}{}{A}$ (requires $\ofglob{\Gamma}{A}{\typ{i}}$)
\item $\ofglob{\Gamma}{\alpha}{G}$ (requires $\wfglob{\Gamma}{G}{}{A}$)
\item $\wfdepglob{\Gamma}{H}{}{x^A.B}{G}$ (requires $\wfglob{\Gamma}{G}{}{A}$
  and $\wftype{\Gamma,x:A}{B}$)
\item $\ofdepglob{\Gamma}{u}{H}{\alpha}$ (requires
  $\wfdepglob{\Gamma}{H}{}{x^A.B}{G}$ and $\ofglob{\Gamma}{\alpha}{G}$)
\item $\ofinterp{\Gamma}{\delta}{\Delta}{A}$ (requires $\wfdiag{\Delta}$ and
  $\wftype{\Gamma}{A}$)
\end{itemize}

\section{Typing rules}

\subsection{Diagrams}

\begin{small}
  \[
  \infer{\wfdiag{\tptm{x}{\diagbase}}}{}
  \qquad\qquad
  \infer{\wfdiag{\Delta,\tptm{y}{\diag G},\tptm{p}{\homj{\diag{G}}{x}{y}}}}
  {\wfdiaglob{\Delta}{\diag G}
    & (\tptm{x}{\diag{G}}) \in \Delta}\]
\end{small}

\subsection{Diagram globs}

\begin{small}
  \[
  \infer{\wfdiaglob{\Delta}{\diagbase}}
  {}%\wfdiag{\Delta}}
  \qquad\qquad
  \infer{\wfdiaglob{\Delta}{\homj{\diag G}{\diag M}{\diag N}}}
  {\ofdiaglob{\Delta}{\diag M}{\diag G}
    & \ofdiaglob{\Delta}{\diag N}{\diag G}}
  \]
\end{small}

\subsection{Diagram terms}

\begin{small}
  \[
  \infer{\ofdiaglob{\Delta}{x}{\diag G}}
  {(\tptm{x}{\diag G})\in\Delta}
  \qquad\qquad
  \infer{\ofdiaglob{\Delta}{\diagcoh{\Delta.\diag G}{\diag\delta}}{\Delta'}}
  {\wfdiaglob{\Delta}{\diag G}
    & \substdiaglob{\Delta}{\diag\delta}{\Delta'}}
  \]
\end{small}

\subsection{Diagram substitutions}

\begin{small}
  \[
  \infer{\substdiaglob{\Delta}{(\diag M/x)}{(\tptm{x}{\diagbase})}}
  {\ofdiaglob{\Delta}{\diag M}{\diagbase}}
  \qquad
  \infer{\substdiaglob{\Delta}{(\diag \delta,\diag N/y, \diag p/p)}
    {(\Delta',\tptm{y}{\diag G},\tptm{p}{\homj{\diag{G}}{x}{y}})}}
  {\substdiaglob{\Delta}{\diag \delta}{\Delta'}
    & \ofdiaglob{\Delta}{\diag N}{\tsubst{\diag G}{\diag \delta}}
    & \ofdiaglob{\Delta}{\diag p}{\homj{\tsubst{\diag G}{\diag\delta}}
      {\tsubst{x}{\diag \delta}}{\diag N}}
    & (\tptm{x}{\diag G})\in\Delta'}
  \]
\end{small}

\subsection{Contexts}

\begin{small}
  \[
  \infer{\wfctx{\varnothing}}{}
  \qquad\qquad
  \infer{\wfctx{\Gamma,x:A}}
  {\wfctx{\Gamma}
    & \wftype{\Gamma}{A}
    & (x\not\in\Gamma)}
  \]
\end{small}

% \framebox{\wfsub{\Gamma}{\theta}{\Gamma'}} \\ \\

% \infer{\wfsub{\Gamma}{\cdot}{\cdot}}{}
% \qquad
% \infer{\wfsub{\Gamma}{\theta,M/x}{\Gamma',\tptm{x}{G}}}
%       {\wfsub{\Gamma}{\theta}{\Gamma'} &
%        \ofglob{\Gamma}{M}{\tsubst{G}{\theta}}}
% \text{The only place where $\Gamma$ on left is not of level 0 is $\wfglob{\Gamma'}{G}{-}{-}$
%   in this rule?}\\ \\

\subsection{Globs}

\begin{small}
  \[
  \infer{\wfglob{\Gamma}{A}{0}{A}}
  {\oftp{\Gamma}{A}{\typ{i}}}
  \qquad\qquad
  \infer{\wfglob{\Gamma}{\homj{G}{M}{N}}{n+1}{A}}
  {\wfglob{\Gamma}{G}{n}{A} &
    \oftp{\Gamma}{M}{G} &
    \oftp{\Gamma}{N}{G}
  }
  \]
\end{small}

\subsection{Interpretation of diagram contexts}

\begin{small}
  \[\infer{\ofinterp{\Gamma}{(M/x)}{\tptm{x}{\diagbase}}{A}}
  {\ofglob{\Gamma}{M}{A}}
  \qquad
  \infer{\ofinterp{\Gamma}{(\delta,N/y, \alpha/p)}
    {(\Delta,\tptm{y}{\diag G},\tptm{p}{\homj{\diag{G}}{x}{y}})}{A}}
  {\ofinterp{\Gamma}{\delta}{\Delta}{A}
    & \ofglob{\Gamma}{N}{\interpglob{\diag G}{A}{\delta}}
    & \ofdiaglob{\Gamma}{\alpha}{
      \homj{\interpglob{\diag G}{A}{\delta}}{\delta(x)}{N}}
    & (\tptm{x}{\diag G})\in\Delta}
\]
\end{small}

We have the following operations
\begin{itemize}
\item $\wfglob{\Gamma}{\interpglob{\diag G}{A}{\delta}}{}{A}$ whenever
  $\wfdiaglob{\Delta}{\diag G}$ and $\ofinterp{\Gamma}{\delta}{\Delta}{A}$
\item $\ofglob{\Gamma}{\interpglob{\diag M}{A}{\delta}}{} {\interpglob{\diag
      G}{A}{\delta}}$ whenever $\ofdiaglob{\Delta}{\diag M}{\diag G}$ and
  $\ofinterp{\Gamma}{\delta}{\Delta}{A}$
\item $\ofinterp{\Gamma}{\interpglob{\diag\delta}{A}{\delta}}{\Delta'}{A}$
  whenever $\ofdiaglob{\Delta}{\diag\delta}{\Delta'}$ and
  $\ofinterp{\Gamma}{\delta}{\Delta}{A}$
\end{itemize}

\begin{small}
  \[
  \begin{array}{rcl}
    \interpglob{\diagbase}{A}{\delta} & := & A \\
    \interpglob{(\homj{\diag G}{\diag M}{\diag N})}{A}{\delta} & := &
    \homj{\interpglob{\diag G}{A}{\delta}}{\interpglob{\diag M}{A}{\delta}}
    {\interpglob{\diag N}{A}{\delta}}\\\\

    \interpglob{x}{A}{\delta} & := & \delta(x) \\
    \interpglob{\diagcoh{\Delta.\diag{G}}{\diag \delta'}}{A}{\delta} & := &
    \coh{\Delta.\diag G}{A}{\interpdiag{\diag\delta'}{A}{\delta}}\\\\

    \interpglob{(\diag M/x)}{A}{\delta} & := & \interpglob{M}{A}{\delta}/x \\
    \interpglob{(\diag \delta,\diag N/y,\diag \alpha/p)}{A}{\delta} & := &
    (\interpglob{\diag\delta}{A}{\delta},\interpglob{\diag N}{A}{\delta}/y,
    \interpglob{\diag\alpha}{A}{\delta}/p)
  \end{array}
  \]
\end{small}

\subsection{Terms}

\paragraph{Coherences}

\begin{small}
  \[
  \infer{\ofglob{\Gamma}{\coh{\ctx{\Delta}.\diag{G}}{A}{\delta}}
    {\interpglob{\diag{G}}{A}{\delta}}}
  {\wfdiag{\Delta}
    & \wfdiaglob{\Delta}{\diag G}
    & \oftp{\Gamma}{A}{\typ{i}}
    & \ofinterp{\Gamma}{\delta}{\Delta}{A}}
  \]
\end{small}

\paragraph{Ap}

\begin{small}
  \[\infer{\ofglob{\Gamma}{\ap{(x^A.M^H)}{\alpha^G}}
    {\Ap{(x^A.M^H)}{G}}}
  {\wfglob{\Gamma}{G}{n}{A}
    & \ofglob{\Gamma}{\alpha}{G}
    & \wfglob{\Gamma}{H}{m}{B}
    & \ofglob{\Gamma,x:A}{M}{H}}\]

  where $\dsd{Ap}$ is a meta-operation such that

  \[\infer{\wfglob{\Gamma}{(\Ap{(x^A.M^H)}{G})}{n+m}
    {B}}
  {\wfglob{\Gamma}{G}{n}{A}
    & \ofglob{\Gamma}{\alpha}{G}
    & \wfglob{\Gamma}{H}{m}{B}
    & \ofglob{\Gamma,x:A}{M}{H}}\]

  The definition of $\dsd{Ap}$ is the following:

  \[
  \begin{array}{rcl}
    \Ap{(x^A.M^H)}{A} & := & H \\
    \Ap{(x^A.M^H)}{(\homj{G}{N}{N'})} & := & \left(
      \homj{\Ap{(x^A.M^H)}{G}}
      {\ap{(x^A.M^H)}{N^G}}{\ap{(x^A.M^H)}{N'^G}}\right)
  \end{array}
  \]
\end{small}

\begin{small}
  \[
  \apn{0}{(x.M)}{N}  \equiv  \subst{M}{N}{x}
  \text{ (\FIXME{definition or reduction or something else?})} \\ \\
  \]
\end{small}

\FIXME{do we need more equations for \apn{}{(x.M)}{N}? are
    they provable?}

\FIXME{define \apn{n}{(x.M)}{\delta}}

\subsection{Depglobs}

\FIXME{Do we need dependent globs over several variables?}\\

\begin{small}
  \[\infer{\wfdepglob{\Gamma}{(x^A.H)}{0,m}{x^A.B}{A}}
  {\wftype{\Gamma}{A}
    & \wftype{\Gamma,x:A}{B}
    & \wfglob{\Gamma,x:A}{H}{m}{B}
  }\]

  \[\infer{\wfdepglob{\Gamma}{(\dhomj{H}{u}{v}{\blank})}{n+1,m}
    {x^A.B}{\homj{G}{M}{N}}} {\wfglob{\Gamma}{G}{n}{A} &
    \ofglob{\Gamma}{M,N}{G}
    & \wfdepglob{\Gamma}{H}{n,m}{x^A.B}{G} & \ofdepglob{\Gamma}{u}{H}{M} &
    \ofdepglob{\Gamma}{v}{H}{N} }\]
\end{small}

\subsection{Dependent terms}

\paragraph{Dependent coherences}



\paragraph{Apd}

\begin{small}
  \[\infer{\ofdepglob{\Gamma}{\apd{(x^A.M^H)}{\alpha^G}}
    {(\Apd{(x^A.M^H)}{G})}{\alpha}}
  {\wfglob{\Gamma}{G}{n}{A}
    & \ofglob{\Gamma}{\alpha}{G}
    & \wfglob{\Gamma,x:A}{H}{m}{B}
    & \ofglob{\Gamma,x:A}{M}{H}}\]

  where $\dsd{Apd}$ is a meta-operation such that

  \[\infer{\wfdepglob{\Gamma}{(\Apd{(x^A.M^H)}{G})}{n,m}
    {x^A.B}{G}}
  {\wfglob{\Gamma}{G}{n}{A}
    & \wfglob{\Gamma,x:A}{H}{m}{B}
    & \ofglob{\Gamma,x:A}{M}{H}}\]

  The definition of $\dsd{Ap}$ is the following:

  \[
  \begin{array}{rcl}
    \Apd{(x^A.M^H)}{A} & := & x^A.H \\
    \Apd{(x^A.M^H)}{(\homj{G}{N}{N'})} & := & \left(
      \dhomj{\Apd{(x^A.M^H)}{G}}
      {\apd{(x^A.M^H)}{N^G}}{\apd{(x^A.M^H)}{N'^G}}{\blank}\right)
  \end{array}
  \]
\end{small}

\FIXME{Reductions between the dependent and nondependent versions}

\subsection{Useful coherences}

\[\idt{A}{M}:=\coh{x:\diagbase.\homj{\diagbase}{x}{x}}{A}{M/x}\]

\subsection{Pi}

\begin{small}
  \[
  \infer{\ofglob{\Gamma}{\app{M}{N}}{\subst{B}{N}{x}}}
  {\ofglob{\Gamma}{M}{\picl{x}{A}{B}} & \ofglob{\Gamma}{N}{A}} \qquad
  \infer{\ofglob{\Gamma}{\ulam{x}{\alpha}}{G}}
  {\wfglob{\Gamma}{G}{n}{\picl{x}{A}{B}} &
    \ofglob{\Gamma,\tptm{x}{A}}{\alpha}{\Apn{n}{(f.\app{f}{x})}{G}}}
  \]
\[
  \begin{array}{rcl}
  \apn{n}{(f.\app f M)}{(\ulam{x}{\alpha})} & \equiv & \tsubst{\alpha}{M/x} \\

\alpha & \equiv & \ulam{x}{\apn{n}{(f.\app f x)}{\alpha}} \text{ (\FIXME{Can we get away without $\eta$ definitionally?})} \\

\coh{\Delta.J}{\picl{x}{A}{B}}{\delta} & \equiv & \ulam{x}{\coh{\Delta.J}{B}{\apn{}{(f.\app f x)}{\delta}}} \\
 
\end{array}
\]
\end{small}
%\end{document}

% \qquad
% \\ \\


% \\ \\



% \end{array}
% \]
% \end{small}
%\end{document}






% \\ \\

% \\ \\


% \\ \\

% \framebox{\oftp{\Gamma}{M}{A}} \\ \\

% \begin{array}{rcl}
% A,M & ::= & \picl{x}{A}{B} \mid \sigmacl{x}{A}{B} \mid \idtp{A}{M}{N} \mid
% \typ{i} \mid
% \dsd{S^1}\mid \dsd{S^2} \mid \dsd{2} \\ 
% & & \mid \app M N \mid \base{1} \mid \srec{1}{C}{M}{\alpha}{N} \mid
% \base{2} \mid \srec{2}{C}{M}{\alpha}{N} 
% \end{array}



% \end{array}
% \]
% \end{small}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "paper"
%%% End: 
