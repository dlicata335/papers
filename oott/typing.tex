\newcommand\diagbase[0]{\ensuremath{\mathord{*}}}
\newcommand\interpdiag[2]{\ensuremath{[ #1 ]_{#2}}}

\section{Judgments}

We have a lot of judgments:

\begin{itemize}
\item $\wfdiag{\Delta}$
\item $\wfdiaglob{\Delta}{\diag G}$ (requires $\wfdiag{\Delta}$)
\item $\ofdiaglob{\Delta}{u}{\diag G}$ (requires $\wfdiaglob{\Delta}{\diag G}$)
\item $\substdiaglob{\Delta}{\diag \delta}{\Delta'}$ (requires $\wfdiag{\Delta}$
  and $\wfdiag{\Delta'}$)
\item $\wfctx{\Gamma}$
\item $\wfglobctx{\Gamma}$
\item $\wfsub{\Gamma}{\theta}{\Gamma'}$ (requires $\wfctx{\Gamma}$ and
  $\wfglobctx{\Gamma'}$)
\item $\wftype{\Gamma}{A}$ (requires $\wfctx{\Gamma}$)
\item $\wfglob{\Gamma}{G}{}{A}$ (requires $\wftype{\Gamma}{A}$)
\item $\ofglob{\Gamma}{\alpha}{G}$ (requires $\wfglob{\Gamma}{G}{}{A}$)
\item $\wfdepglob{\Gamma}{H}{}{x^A.B}{G}$ (requires $\wfglob{\Gamma}{G}{}{A}$
  and $\wftype{\Gamma,x:A}{B}$)
\item $\ofdepglob{\Gamma}{u}{H}{\alpha}$ (requires
  $\wfdepglob{\Gamma}{H}{}{x^A.B}{G}$ and $\ofglob{\Gamma}{\alpha}{G}$)
\end{itemize}

\section{Typing rules}

\subsection{Diagrams}

\begin{small}
  \[
  \infer{\wfdiag{\tptm{x}{\diagbase}}}{}
  \qquad\qquad
  \infer{\wfdiag{\Delta,\tptm{y}{\diag G},\tptm{p}{\homj{\diag{G}}{x}{y}}}}
  {\wfdiaglob{\Delta}{\diag G}
    & (\tptm{x}{\diag{G}}) \in \Delta}\]
\end{small}

\subsection{Diagram globs}

\begin{small}
  \[
  \infer{\wfdiaglob{\Delta}{\diagbase}}
  {\wfdiag{\Delta}}
  \qquad\qquad
  \infer{\wfdiaglob{\Delta}{\homj{\diag G}{\diag M}{\diag N}}}
  {\ofdiaglob{\Delta}{\diag M}{\diag G}
    & \ofdiaglob{\Delta}{\diag N}{\diag G}}
  \]
\end{small}

\subsection{Diagram terms}

\begin{small}
  \[
  \infer{\ofdiaglob{\Delta}{x}{\diag G}}
  {(\tptm{x}{\diag G})\in\Delta}
  \qquad\qquad
  \infer{\ofdiaglob{\Delta}{\diagcoh{\Delta.\diag G}{\diag\delta}}{\Delta'}}
  {\wfdiaglob{\Delta}{\diag G}
    & \substdiaglob{\Delta}{\diag\delta}{\Delta'}}
  \]
\end{small}

\subsection{Diagram substitutions}

\FIXME{TODO, if we do not define diagram contexts, then diagram substitutions
  are a bit annoying to define}

% \diag \delta ::= \cdot \mid \diag M / x \\

\subsection{Contexts}

\begin{small}
  \[
  \infer{\wfctx{\varnothing}}{}
  \qquad\qquad
  \infer{\wfctx{\Gamma,x:A}}
  {\wfctx{\Gamma}
    & \wftype{\Gamma}{A}
    & (x\not\in\Gamma)}
  \]
\end{small}

\subsection{Glob contexts}

We donâ€™t want that, we want $\ofglob{\Gamma}{\delta}{[\Delta]_A}$ to be a
judgement on its own.

\begin{small}
\[
\begin{array}{l}
\framebox{\wfctx{\Gamma}{n}} \\ \\

\infer{\wfctx{\cdot}{n}}{}
\qquad
\infer{\wfctx{\Gamma,\tptm{x}{G}}{{\max(n,m)}}}
       {\wfctx{\Gamma}{n} &
        \wfglob{\Gamma}{G}{m}{A}}
\\ \\

\framebox{\wfsub{\Gamma}{\theta}{\Gamma'}} \\ \\

\infer{\wfsub{\Gamma}{\cdot}{\cdot}}{}
\qquad
\infer{\wfsub{\Gamma}{\theta,M/x}{\Gamma',\tptm{x}{G}}}
      {\wfsub{\Gamma}{\theta}{\Gamma'} &
       \ofglob{\Gamma}{M}{\tsubst{G}{\theta}}}
\text{The only place where $\Gamma$ on left is not of level 0 is $\wfglob{\Gamma'}{G}{-}{-}$
  in this rule?}\\ \\


\framebox{\wfglob{\Gamma}{G}{n}{A}} \\ \\

\infer{\wfglob{\Gamma}{A}{0}{A}}
      {\oftp{\Gamma}{A}{\typ{i}}}
\qquad
\infer{\wfglob{\Gamma}{\homj{G}{M}{N}}{n+1}{A}}
      {\wfglob{\Gamma}{G}{n}{A} &
        \oftp{\Gamma}{M}{G} &
        \oftp{\Gamma}{N}{G}
      }
\\ \\

\text{There is a meta-operation:}
\infer{\wfglob{\Gamma}{\Apn{n}{(x.M)}{G}}{n}{B}}
      {\wfglob{\Gamma}{G}{n}{A} &
       \oftp{\Gamma}{A,B}{\typ{i}} & 
       \oftp{\Gamma,\tptm{x}{A}}{M}{B}}
\text{defined as follows:}
\\ \\
\begin{array}{rcl}
\Apn{n}{(\tptm{x}{A}.\tptm{M}{B})}{A} & = & {B} \\
\Apn{n+1}{(x.M)}{\homj{G}{N}{N'}} & = & \homj{\Apn{n}{(x.M)}{G}}{\apn{n}{(x.M)}{N}}{\apn{n}{(x.M)}{N'}} \\
\end{array}

\\ \\

\framebox{\tsubst{G}{\theta}}
\\ \\

\text{Just ordinary substitution.}
\\ \\

\framebox{$\interpdiag{\Delta}{A} = \Gamma$} \\ \\
\framebox{$\interpdiag{\diag{G}}{A} = G$} \\ \\
\text{etc.}

\\ \\
\end{array}
\]
\end{small}

\begin{small}
\[
\begin{array}{l}
\framebox{\ofglob{\Gamma}{M}{G}} \\ \\

\infer{\ofglob{\Gamma}{\apn{n}{(x.M)}{\alpha}}{\Apn{n}{(x.M)}{G}}}
      {\oftp{\Gamma,\tptm{x}{A}}{M}{B} &
       \ofglob{\Gamma}{\alpha}{G_A} &
      }
\quad
\text{\FIXME{do we need n-ary ap?}}
\\ \\

\infer{\ofglob{\Gamma}{\coh{\ctx{\Delta}.\diag{G}}{A}{\delta}}{\tsubst{\interpdiag{\diag{G}}{A}}{\delta}}}
      {\wfdiag{\Delta} &
       \wfdiaglob{\Delta}{\diag G} & %{n+1} &
       \oftp{\Gamma}{A}{\typ{i}} &
       \wfsub{\Gamma}{\delta}{\interpdiag{\Delta}{A}}
      }
\\ \\

\infer{\ofglob{\Gamma}{\app{M}{N}}{\subst{B}{N}{x}}}
      {\ofglob{\Gamma}{M}{\picl{x}{A}{B}} &
        \ofglob{\Gamma}{N}{A}}
\qquad
\infer{\ofglob{\Gamma}{\ulam{x}{\alpha}}{G}}
      {\wfglob{\Gamma}{G}{n}{\picl{x}{A}{B}} &
       \ofglob{\Gamma,\tptm{x}{A}}{\alpha}{\Apn{n}{(f.\app{f}{x})}{G}}}
\\ \\

\infer{\ofglob{\Gamma}{\base{1}}{\dsd{S^1}}}{}
\qquad
\infer{\ofglob{\Gamma}{\lp{1}}{\homj{\dsd{S^1}}{\base{1}}{\base{1}}}}
      {}
\qquad
\text{\FIXME{S1-rec}}
\\ \\
\infer{\ofglob{\Gamma}{\base{2}}{\dsd{S^2}}}{}
\qquad
\infer{\ofglob{\Gamma}{\lp{2}}{\homj{\homj{\dsd{S^2}}{\base{2}}{\base{2}}}{\idt{\dsd{S^2}}{\base{2}}}{\idt{\dsd{S^2}}{\base{2}}}}}
      {} 
\quad
\text{\FIXME{S2-rec}}
\\ \\
\text{\idt{A}{M} is \coh{x:\diagbase.\homj{\diagbase}{x}{x}}{A}{M/x}} 

\\ \\
\begin{array}{rcl}
\apn{0}{(x.M)}{N} & \equiv & \subst{M}{N}{x} \text{ (\FIXME{derivable or admissible?})} \\ \\
%% ap  is 0 N N
%% [ ] is N 0 N
%% this says they agree for 0 0 0

\apn{n}{(f.\app f M)}{(\ulam{x}{\alpha})} & \equiv & \tsubst{\alpha}{M/x} \\

\alpha & \equiv & \ulam{x}{\apn{n}{(f.\app f x)}{\alpha}} \text{ (\FIXME{Can we get away without $\eta$ definitionally?})} \\

\coh{\Delta.J}{\picl{x}{A}{B}}{\delta} & \equiv & \ulam{x}{\coh{\Delta.J}{B}{\apn{}{(f.\app f x)}{\delta}}} \\
\\ 

\apn{1}{(x.\srec{1}{C}{b'}{l'}{x})}{\lp{1}} & \equiv & l' \\

\apn{n}{(x.\srec{1}{C}{b'}{l'}{x})}{\coh{\ctx \Delta.J}{\dsd{S^1}}{\delta}} & \equiv & 
\coh{\Delta.J}{C}{\apn{n}{(x.\srec{1}{C}{b'}{l'}{x})}{\delta}} \\

\\ 

\apn{2}{(x.\srec{2}{C}{b'}{l'}{x})}{\lp{2}} & \equiv & l' \\

\apn{n}{(x.\srec{2}{C}{b'}{l'}{x})}{\coh{\ctx \Delta.J}{\dsd{S^2}}{\delta}} & \equiv & 
\coh{\Delta.J}{C}{\apn{n}{(x.\srec{2}{C}{b'}{l'}{x})}{\delta}} \\
\end{array}
\\ \\
\text{(If we had simple $\eta$ for spheres the above would cover all x.M)}
\\ \\
\text{\FIXME{do we need more equations for \apn{}{(x.M)}{N}? are
    they provable?}}
\\ \\
\text{\FIXME{define \apn{n}{(x.M)}{\delta}}}

\\ \\
\end{array}
\]
\end{small}

\noindent
\framebox{TODO}
\begin{small}
\begin{itemize}
\item univalent universe
\item path over a path / transport
\item dependent elim for spheres
\end{itemize}
\end{small}

%\end{document}

% \qquad
% \\ \\


% \\ \\



% \end{array}
% \]
% \end{small}
%\end{document}






% \\ \\

% \\ \\


% \\ \\

% \framebox{\oftp{\Gamma}{M}{A}} \\ \\

% \begin{array}{rcl}
% A,M & ::= & \picl{x}{A}{B} \mid \sigmacl{x}{A}{B} \mid \idtp{A}{M}{N} \mid
% \typ{i} \mid
% \dsd{S^1}\mid \dsd{S^2} \mid \dsd{2} \\ 
% & & \mid \app M N \mid \base{1} \mid \srec{1}{C}{M}{\alpha}{N} \mid
% \base{2} \mid \srec{2}{C}{M}{\alpha}{N} 
% \end{array}



% \end{array}
% \]
% \end{small}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "paper"
%%% End: 
