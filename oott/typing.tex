\begin{small}
\[
\begin{array}{l}

\framebox{\wfdiag{\Delta}{X}} \\ \\

\infer{\wfdiag{x:X}{X}}{} 
\qquad
\infer{\wfdiag{\Delta,\tptm{y}{J},\tptm{p}{\homj{J}{x}{y}}}{X}}
      {\wfjudg{\Delta}{J}{n}{X} &
       \tptm{x}{J} \in \Delta &
      } \\
\text{\FIXME{what's allowed to occur in J?}}
\\ \\

\framebox{\wfdsubst{\Gamma}{\delta}{\Delta}} \\ \\

\infer{\wfdsubst{\Gamma}{M/x}{x:A}}{} 
\qquad
\infer{\wfdsubst{\Gamma}{\delta,\alpha/y,\beta/p}{\Delta,\tptm{y}{J^n_A},\tptm{p}{\homj{J}{x}{y}}}}
      {\wfdsubst{\Gamma}{\delta}{\Delta} &
       \ofjudg{\Gamma}{n}{A}{\alpha}{\tsubst{J}{\delta}} &
       \ofjudg{\Gamma}{n+1}{A}{\beta}{\homj{\tsubst{J}{\delta}}{\delta(x)}{\delta(y)}} &
      } \\ \\

\text{\FIXME{need \tsubst{J}{\delta}}}

\\ \\

\framebox{\wfjudg{\Gamma}{J}{n}{A}} \\ \\

\infer{\wfjudg{\Gamma}{A}{0}{A}}{\oftp{\Gamma}{A}{\typ{i}}}
\qquad
\infer{\wfjudg{\Gamma}{\homj{J}{\alpha}{\beta}}{n+1}{A}}
      {\wfjudg{\Gamma}{J}{n}{A} &
        \oftp{\Gamma}{\alpha}{J} &
        \oftp{\Gamma}{\beta}{J}
      }
\qquad
\infer{\wfjudg{\Gamma}{\Apn{n}{(x.M)}{J}}{n}{B}}
      {\wfjudg{\Gamma}{J}{n}{A} &
       \oftp{\Gamma}{A,B}{\typ{i}} & 
       \oftp{\Gamma,\tptm{x}{A}}{M}{B}}
\\ \\
\text{\FIXME{do we need n-ary Ap?}}
\\ \\

\begin{array}{rcl}
\Apn{0}{(\tptm{x}{A}.\tptm{M}{B})}{A} & \equiv & {B} \\
\Apn{n+1}{(x.M)}{(\homj{J}{\alpha}{\beta})} & \equiv & \homj{(\Apn{n}{(x.M)}{J})}{\apn{n}{(x.M)}{\alpha}}{\apn{n}{(x.M)}{\beta}} \\
\end{array}

\\ \\

\framebox{\ofjudg{\Gamma}{n}{A}{\alpha}{J}} \\ \\

\infer{\ofjudg{\Gamma}{0}{A}{M}{A}} 
      {\oftp{\Gamma}{M}{A}}
\qquad
\infer{\ofjudg{\Gamma}{n}{B}{\apn{n}{(x.M)}{\alpha}}{\Apn{n}{(x.M)}{J}}}
      {\oftp{\Gamma,\tptm{x}{A}}{M}{B} &
       \ofjudg{\Gamma}{n}{A}{\alpha}{J} &
      }
\qquad
\infer{\ofjudg{\Gamma}{n}{A}{\coh{\ctx{\Delta}.J}{A}{\delta}}{\tsubst{J}{A/X,\delta}}}
      {\wfdiag{\Delta}{X} &
       \wfjudg{\tptm{X}{\typ{i}},\Delta}{J}{n}{X} &
       \oftp{\Gamma}{A}{\typ{i}} &
       \wfdsubst{\Gamma}{\delta}{\tsubst{\ctx \Delta}{A/X}}
      }
\\ \\
\infer{\ofjudg{\Gamma}{n}{\picl{x}{A}{B}}{\ulam{x}{\alpha}}{J}}
      {\ofjudg{\Gamma,\tptm{x}{A}}{n}{B}{\alpha}{\Apn{n}{(f.\app{f}{x})}{J}}}
\qquad
\infer{\ofjudg{\Gamma}{1}{\dsd{S^1}}{\lp{1}}{\homj{\dsd{S^1}}{\base{1}}{\base{1}}}}
      {}
\qquad
\infer{\ofjudg{\Gamma}{2}{\dsd{S^1}}{\lp{2}}{\homj{\homj{\dsd{S^2}}{\base{2}}{\base{2}}}{\idt{\dsd{S^2}}{\base{2}}}{\idt{\dsd{S^2}}{\base{2}}}}}
      {}
\\ \\

\text{\idt{A}{M} is \coh{x:X.\homj{X}{x}{x}}{A}{M/x}} \\ \\

\begin{array}{rcl}
\apn{n}{(f.\app f M)}{(\ulam{x}{\alpha})} & \equiv & \tsubst{\alpha}{M/x} \\
\alpha & \equiv & \ulam{x}{\apn{n}{(f.\app f x)}{\alpha}} \\
\coh{\Delta.J}{\picl{x}{A}{B}}{\delta} & \equiv & \ulam{x}{\coh{\Delta.J}{B}{\apn{}{(f.\app f x)}{\delta}}} \\
\apn{n}{(x.\srec{1}{C}{b'}{l'}{x})}{\coh{\ctx \Delta.J}{\dsd{S^1}}{\delta}} & \equiv & 
\coh{\Delta.J}{C}{\apn{n}{(x.\srec{1}{C}{b'}{l'}{x})}{\delta}} \\
\apn{n}{(x.\srec{2}{C}{b'}{l'}{x})}{\coh{\ctx \Delta.J}{\dsd{S^2}}{\delta}} & \equiv & 
\coh{\Delta.J}{C}{\apn{n}{(x.\srec{2}{C}{b'}{l'}{x})}{\delta}} \\
\end{array}
\\ \\

\text{\FIXME{explain \apn{}{(x.M)}{\delta}}}

\\ \\

\framebox{\oftp{\Gamma}{M}{A}} \\ \\

\begin{array}{rcl}
A,M & ::= & \picl{x}{A}{B} \mid \sigmacl{x}{A}{B} \mid \idtp{A}{M}{N} \mid
\typ{i} \mid
\dsd{S^1}\mid \dsd{S^2} \mid \dsd{2} \\ 
& & \mid \app M N \mid \base{1} \mid \srec{1}{C}{M}{\alpha}{N} \mid
\base{2} \mid \srec{2}{C}{M}{\alpha}{N} 
\end{array}



\end{array}
\]
\end{small}
